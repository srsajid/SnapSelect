class SnapSelect{constructor(e){const t=e.querySelectorAll("option");this.optionsArr=Array.prototype.slice.call(t),this.dropdown=e,this.menu=document.createElement("div"),this.selected=document.createElement("div"),this.currentFocus=-1,this.init()}init(){const e=this.optionsArr,t=document.createElement("div");t.classList.add("snap-drpd"),this.dropdown.insertAdjacentElement("afterend",t);const s=this.selected;s.classList.add("snap-drpd-sel"),t.appendChild(s),s.tabIndex=this.dropdown.tabIndex,s.addEventListener("keydown",(e=>{this.handleKeyDown(e.key)&&e.preventDefault()}));let n=this.menu;n.classList.add("snap-drpd-menu"),t.appendChild(n),s.addEventListener("click",(()=>{this.toggleDropdown(n)}));const i=document.createElement("input");i.placeholder="Search...",i.type="text",i.classList.add("snap-drpd-search"),n.appendChild(i);const c=document.createElement("div");c.classList.add("snap-drpd-inn"),n.appendChild(c),e.forEach((e=>{const t=document.createElement("div");t.classList.add("snap-drpd-item"),t.dataset.value=e.value,t.textContent=e.textContent,c.appendChild(t),t.addEventListener("click",(()=>{this.setSelected(t)})),e.selected&&this.setSelected(t)})),this.selectedItem||this.setSelected(c.querySelector("div")),i.addEventListener("input",(()=>{this.filterItems(i.value)})),n.addEventListener("keydown",(e=>{this.handleSearchKeyDown(e.key)&&e.preventDefault()})),document.addEventListener("click",(e=>{this.closeIfClickedOutside(e.target)})),this.dropdown.style.display="none"}toggleDropdown(){let e=this.menu;null!==e.offsetParent?e.style.display="none":(e.style.display="block",e.querySelector("input").focus()),this.clearActive()}setSelected(e){if(!e)return;const t=e.dataset.value;if(this.selected.textContent=e.textContent,this.dropdown.value=t,this.menu.style.display="none",this.menu.querySelector("input").value="",this.menu.querySelectorAll("div").forEach((e=>{e.classList.contains("is-select")&&e.classList.remove("is-select"),null===e.offsetParent&&(e.style.display="")})),e.classList.add("is-select"),void 0!==this.selectedItem&&this.selectedItem!==e){const e=new Event("change");this.dropdown.dispatchEvent(e)}this.selectedItem=e}filterItems(e){let t=this.optionsArr;const s=this.menu.querySelectorAll(".snap-drpd-inn div");e=e.toLowerCase();const n=t.filter((t=>t.textContent.toLowerCase().includes(e))).map((e=>t.indexOf(e)));t.forEach((e=>{n.includes(t.indexOf(e))?null===s[t.indexOf(e)].offsetParent&&(s[t.indexOf(e)].style.display=""):s[t.indexOf(e)].style.display="none"}))}closeIfClickedOutside(e){let t=this.menu;null===e.closest(".snap-drpd")&&e.target!==this&&null!==t.offsetParent&&(t.style.display="none")}handleSearchKeyDown(e){const t=this.menu.querySelectorAll(".snap-drpd-item:not([style*='display: none'])");let s=!1;return"ArrowDown"===e?(this.currentFocus=this.currentFocus===t.length-1?0:this.currentFocus+1,this.addActive(t),s=!0):"ArrowUp"===e?(this.currentFocus=this.currentFocus<=0?t.length-1:this.currentFocus-1,this.addActive(t),s=!0):"Enter"===e?(this.currentFocus>-1&&this.currentFocus<t.length&&t[this.currentFocus].click(),s=!0):"Escape"===e&&this.toggleDropdown(),s}handleKeyDown(e){let t=!1;return"ArrowDown"===e?(this.setSelected(this.selectedItem.nextSibling),t=!0):"ArrowUp"===e?(this.setSelected(this.selectedItem.previousSibling),t=!0):"Enter"===e&&(this.toggleDropdown(),t=!0),t}clearActive(){this.activeItem&&this.activeItem.classList.remove("active"),this.currentFocus=-1,this.activeItem=null}addActive(e){if((!e||this.currentFocus>=e.length)&&(this.currentFocus=0),this.currentFocus<0&&(this.currentFocus=e.length-1),0===e.length)return;let t=e[this.currentFocus];this.activeItem&&this.activeItem.classList.remove("active"),t.classList.add("active"),t.scrollIntoView({block:"nearest"}),this.activeItem=t}}
