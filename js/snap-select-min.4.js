"use strict";class SnapSelect{constructor(e){const t=e.querySelectorAll("option");this.optionsArr=Array.prototype.slice.call(t),this.dropdown=e,this.menu=document.createElement("div"),this.selected=document.createElement("div"),this.currentFocus=-1,this.init()}init(){const e=this.optionsArr,t=document.createElement("div");t.classList.add("snap-drpd"),this.dropdown.insertAdjacentElement("afterend",t);const s=this.selected;s.classList.add("snap-drpd-sel"),t.appendChild(s),s.tabIndex=this.dropdown.tabIndex,s.addEventListener("keydown",e=>{this.handleKeyDown(e.key)&&e.preventDefault()});let i=this.menu;i.classList.add("snap-drpd-menu"),t.appendChild(i),s.addEventListener("click",(()=>{this.toggleDropdown(i)}));const c=document.createElement("input");c.placeholder="Search...",c.type="text",c.classList.add("snap-drpd-search"),i.appendChild(c);const n=document.createElement("div");n.classList.add("snap-drpd-inn"),i.appendChild(n),e.forEach((e=>{const t=document.createElement("div");t.classList.add("snap-drpd-item"),t.dataset.value=e.value,t.textContent=e.textContent,n.appendChild(t),t.addEventListener("click",(()=>{this.setSelected(t)})),e.selected&&this.setSelected(t)})),this.selectedItem||this.setSelected(n.querySelector("div")),c.addEventListener("input",(()=>{this.filterItems(c.value)})),i.addEventListener("keydown",(e=>{this.handleSearchKeyDown(e.key)&&e.preventDefault()})),document.addEventListener("click",(e=>{this.closeIfClickedOutside(e.target)})),this.dropdown.style.display="none"}toggleDropdown(){let e=this.menu;e.offsetParent!==null?e.style.display="none":(e.style.display="block",e.querySelector("input").focus()),this.clearActive()}setSelected(e){if(!e)return;const t=e.dataset.value;this.selected.textContent=e.textContent,this.dropdown.value=t,this.menu.style.display="none",this.menu.querySelector("input").value="",this.menu.querySelectorAll("div").forEach((e=>{e.classList.contains("is-select")&&e.classList.remove("is-select"),e.offsetParent===null&&(e.style.display="")})),e.classList.add("is-select"),void 0!==this.selectedItem&&this.selectedItem!==e&&this.dropdown.dispatchEvent(new Event("change")),this.selectedItem=e}filterItems(e){let t=this.optionsArr,s=this.menu,i=s.querySelectorAll(".snap-drpd-inn div");e=e.toLowerCase();const c=t.filter((t=>t.textContent.toLowerCase().includes(e))),n=c.map((e=>t.indexOf(e)));t.forEach((e=>{n.includes(t.indexOf(e))?i[t.indexOf(e)].offsetParent===null&&(i[t.indexOf(e)].style.display=""):i[t.indexOf(e)].style.display="none"}))}closeIfClickedOutside(e){let t=this.menu;e.closest(".snap-drpd")===null&&e.target!==this&&t.offsetParent!==null&&(t.style.display="none")}handleSearchKeyDown(e){console.log(e);const t=this.menu.querySelectorAll(".snap-drpd-item:not([style*='display: none'])");let s=!1;return e==="ArrowDown"?(this.currentFocus=this.currentFocus===t.length-1?0:this.currentFocus+1,this.addActive(t),s=!0):e==="ArrowUp"?(this.currentFocus=this.currentFocus<=0?t.length-1:this.currentFocus-1,this.addActive(t),s=!0):e==="Enter"?(this.currentFocus>-1&&this.currentFocus<t.length&&t[this.currentFocus].click(),s=!0):e==="Escape"&&this.toggleDropdown(),s}handleKeyDown(e){console.log(e);let t=!1;return e==="ArrowDown"?(this.setSelected(this.selectedItem.nextSibling),t=!0):e==="ArrowUp"?(this.setSelected(this.selectedItem.previousSibling),t=!0):e==="Enter"&&(this.toggleDropdown(),t=!0),t}clearActive(){this.activeItem&&this.activeItem.classList.remove("active"),this.currentFocus=-1,this.activeItem=null}addActive(e){if(!e||this.currentFocus>=e.length&&(this.currentFocus=0),this.currentFocus<0&&(this.currentFocus=e.length-1),e.length===0)return;let t=e[this.currentFocus];this.activeItem&&this.activeItem.classList.remove("active"),t.classList.add("active"),t.scrollIntoView({block:"nearest"}),this.activeItem=t}}
